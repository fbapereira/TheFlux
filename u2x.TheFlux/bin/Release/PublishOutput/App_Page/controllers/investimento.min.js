app.controller("investimentoCtrl",function(n,t,i,r,u){function e(){n.loggedUsuario=u.getUsuario();n.loggedUsuario||(r.path("/login"),U2X_FechaLoader())}function f(){U2X_AbreLoader();var t={};t.id_instituicao=n.loggedUsuario.id_instituicao;i({method:"POST",url:u.url+"/api/InvestimentoRF_Obtem",data:t}).then(function(t){n.investimentos=t.data;n.investimentos.forEach(function(t){o(t);s(t);n.targetInvestimento!=undefined&&t.id==n.targetInvestimento.id&&(n.targetInvestimento=t)});U2X_FechaLoader()},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})}function o(n){i({method:"POST",url:u.url+"/api/Aporte_Obtem",data:n}).then(function(t){n.aportes=t.data;n.aportes=n.aportes.sort(function(n,t){return moment(n.data_compra).isBefore(moment(t.data_compra))?-1:moment(n.data_compra).isAfter(moment(t.data_compra))?1:0})},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})}function s(n){i({method:"POST",url:u.url+"/api/Variacao_Obtem",data:n}).then(function(t){n.variacao=t.data;n.variacao=n.variacao.sort(function(n,t){return moment(n.data).isBefore(moment(t.data))?-1:moment(n.data).isAfter(moment(t.data))?1:0})},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})}U2X_ConfiguraInterface();e();f();n.variacao={};n.ShowVariacao=function(){n.variacao={};$("#mdlNovoVariacao").modal("open")};n.CloseVariacao=function(){$("#mdlNovoVariacao").modal("close")};n.AddVariacao=function(){if(!n.variacao.data){Materialize.toast("Favor digitar a data",4e3);return}if(!n.variacao.valor){Materialize.toast("Favor digitar o valor",4e3);return}n.variacao.id_investimento_RF=n.targetInvestimento.id;U2X_AbreLoader();i({method:"POST",url:u.url+"/api/Variacao_Adicionar",data:n.variacao}).then(function(){f();U2X_FechaLoader();n.novoNome="";$("#mdlNovoVariacao").modal("close");Materialize.toast("Novo aporte cadastrado",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return});$("#mdlNovoVariacao").modal("close")};n.aporte={};n.showAporte=function(){n.aporte={};$("#mdlNovoAporte").modal("open")};n.CloseAporte=function(){$("#mdlNovoAporte").modal("close")};n.targetRemoveInvestimento={};n.AbreremoveInvestimento=function(t){n.targetRemoveInvestimento=t;$("#mdlRemoveInvestimento").modal("open")};n.FecharemoveInvestimento=function(){$("#mdlRemoveInvestimento").modal("close")};n.removeInvestimento=function(){U2X_AbreLoader();i({method:"POST",url:u.url+"/api/InvestimentoRF_Deleta",data:n.targetRemoveInvestimento}).then(function(){f();U2X_FechaLoader();$("#mdlRemoveInvestimento").modal("close");Materialize.toast("Investimento removido com sucesso",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})};n.AddAporte=function(){if(!n.aporte.data_compra){Materialize.toast("Favor digitar a data",4e3);return}if(!n.aporte.valor_aporte){Materialize.toast("Favor digitar o valor",4e3);return}n.aporte.id_investimento_RF=n.targetInvestimento.id;U2X_AbreLoader();i({method:"POST",url:u.url+"/api/Aporte_Adicionar",data:n.aporte}).then(function(){f();U2X_FechaLoader();n.novoNome="";$("#mdlNovoAporte").modal("close");Materialize.toast("Novo aporte cadastrado",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return});$("#mdlNovoAporte").modal("close")};n.ShowAjuda=function(){$("#mdlAjuda").modal("open")};n.CloseAjuda=function(){$("#mdlAjuda").modal("close")};n.ViewInvestimento=function(t){n.targetInvestimento=t};n.ShowInvestimento=function(){n.novoNome="";$("#mdlNovoInvestimento").modal("open")};n.CloseInvestimento=function(){$("#mdlNovoInvestimento").modal("close")};n.AddInvestimento=function(){var t={};if(!n.novoNome){Materialize.toast("Favor digitar nome",4e3);return}t.nome=n.novoNome;t.is_ativo=!0;t.id_instituicao=n.loggedUsuario.id_instituicao;U2X_AbreLoader();i({method:"POST",url:u.url+"/api/InvestimentoRF_Adicionar",data:t}).then(function(){f();U2X_FechaLoader();n.novoNome="";$("#mdlNovoInvestimento").modal("close");Materialize.toast("Novo Investimento cadastrado",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return});$("#mdlNovoInvestimento").modal("close")};n.CalculaValorAporteTotal=function(n){var t=0;return n.aportes==undefined?0:(n.aportes.forEach(function(n){t=t+n.valor_aporte}),t)};n.CalculaValorAtual=function(t){if(t.variacao==undefined)return n.CalculaValorAporteTotal(t);var i=t.variacao[t.variacao.length-1];return i==undefined?n.CalculaValorAporteTotal(t):i.valor};n.CalculaPercentual=function(t){var i=n.CalculaValorAporteTotal(t),r=n.CalculaValorAtual(t);return(r/i-1)*100};n.trataValores=U2X_TrataValores;n.dataFormat=function(n){return moment(n).format("DD/MM/YYYY")};n.removeAporte={};n.AbreRemoveAporte=function(t){n.removeAporte=t;$("#mdlRemoveAporte").modal("open")};n.FechaRemoveAporte=function(){$("#mdlRemoveAporte").modal("close")};n.RemoveAporte=function(){U2X_AbreLoader();i({method:"POST",url:u.url+"/api/Aporte_Remove",data:n.removeAporte}).then(function(){f();U2X_FechaLoader();$("#mdlRemoveAporte").modal("close");Materialize.toast("Aporte removido com sucesso",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})};n.removeVariacao={};n.AbreRemoveVariacao=function(t){n.removeVariacao=t;$("#mdlRemoveVariacao").modal("open")};n.FechaRemoveVariacao=function(){$("#mdlRemoveVariacao").modal("close")};n.RemoveVariacao=function(){U2X_AbreLoader();i({method:"POST",url:u.url+"/api/Variacao_Remove",data:n.removeVariacao}).then(function(){f();U2X_FechaLoader();$("#mdlRemoveVariacao").modal("close");Materialize.toast("Variação removido com sucesso",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})}});