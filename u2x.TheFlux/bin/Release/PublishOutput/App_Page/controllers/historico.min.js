app.controller("historicoCtrl",function(n,t,i,r,u){function e(){n.loggedUsuario=u.getUsuario();n.loggedUsuario||(r.path("/login"),U2X_FechaLoader())}function o(){U2X_AbreLoader();var n=c(),t=l(),i=h();Promise.all([n,t,i]).then(function(){f();Materialize.updateTextFields()})}function s(){var i;n.searchDate=[];i=[];n.lstMovimentacao.forEach(function(n){i.push(moment(n.data))});for(var u=moment.min(i),f=moment.max(i),t=Number(moment(u).format("MM")),r=Number(moment(u).format("YYYY")),e=Number(moment(f).format("MM")),o=Number(moment(f).format("YYYY"));t!=e||r!=o;)n.searchDate.push(t+"/"+r),t=t+1,t>12&&(r=r+1,t=1);n.searchDate.push(e+"/"+o)}function h(){return new Promise(function(t,r){i({method:"GET",url:u.url+"/api/usuario/"+n.loggedUsuario.id_instituicao}).then(function(i){n.lstUsuario=i.data;t()},function(n){U2X_TrataErro(n);U2X_FechaLoader();r()})})}function c(){return new Promise(function(t,r){i({method:"GET",url:u.url+"/api/TipoMovimentacao/"+n.loggedUsuario.id_instituicao}).then(function(i){n.lstTipoMovimentacao=i.data;t()},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);r()})})}function l(){return new Promise(function(t,r){var f={};f.id_instituicao=n.loggedUsuario.id_instituicao;i({method:"POST",url:u.url+"/api/TipoPagamento_Obtem",data:f}).then(function(i){n.lstTipoPagamento=i.data;t()},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);r()})})}function f(){i({method:"POST",url:u.url+"/api/MovimentacaoInstitucional_Obtem",data:n.loggedUsuario}).then(function(t){if(n.lstMovimentacao=t.data,!n.lstMovimentacao){n.oSearchTipo="-1";n.oSearchDate="1";return}n.lstMovimentacao.forEach(function(t){t.showMore=!1;t.isEntrada||(t.valor=t.valor*-1);t.tipoMovimentacao=n.lstTipoMovimentacao.filter(function(n){return n.id==t.idTipoMovimentacao})[0];t.tipoPagamento=n.lstTipoPagamento.filter(function(n){return n.id==t.idTipoPagamento})[0];t.usuario=n.lstUsuario.filter(function(n){return n.id==t.idUsuario})[0].login});n.lstMovimentacao=n.lstMovimentacao.sort(function(n,t){return moment(t.data).isBefore(moment(n.data))?-1:moment(t.data).isAfter(moment(n.data))?1:0});n.oSearchTipo="-1";n.oSearchDate="1";n.Filtrar();s();U2X_FechaLoader()},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);r.path("/");U2X_FechaLoader();return})}U2X_ConfiguraInterface();$(".modal").modal({dismissible:!0,opacity:.8,ready:function(){Materialize.updateTextFields()}});U2X_AbreLoader();e();o();n.Filtrar=function(){if(!n.lstMovimentacao)return!1;n.lstMovimentacaoFiltered=n.lstMovimentacao.filter(function(t){var i=!0;if(n.oSearchDate!="1"){var u=n.oSearchDate.split("/")[0],f=n.oSearchDate.split("/")[1],r=moment(t.data),e=Number(moment(r).format("MM")),o=Number(moment(r).format("YYYY"));(u!=e||f!=o)&&(i=!1)}return n.oSearchTipo!="-1"&&n.oSearchTipo!=t.isEntrada&&(i=!1),i})};n.targetMovimentacao;n.ApagarShow=function(t){n.targetMovimentacao=t;$("#mdlApagar").modal("open")};n.ApagarHide=function(){$("#mdlApagar").modal("close")};n.EditarShow=function(t){n.targetMovimentacao=t;n.targetMovimentacao.isEntrada=t.isEntrada.toString();n.targetMovimentacao.data=moment(n.targetMovimentacao.data).toDate();n.targetMovimentacao.valor<0&&(n.targetMovimentacao.valor=n.targetMovimentacao.valor*-1);$("#mdlEditar").modal("open")};n.EditarHide=function(){(n.targetMovimentacao.isEntrada==0||n.targetMovimentacao.isEntrada==2)&&(n.targetMovimentacao.valor=n.targetMovimentacao.valor*-1);$("#mdlEditar").modal("close")};n.Apagar=function(){U2X_AbreLoader();i({method:"POST",url:u.url+"/api/Movimentacao_Deletar",data:n.targetMovimentacao}).then(function(){f();U2X_FechaLoader();$("#mdlApagar").modal("close");Materialize.toast("Exclusão concluida com sucesso",4e3)},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})};n.Editar=function(){U2X_AbreLoader();i({method:"POST",url:u.url+"/api/MovimentacaoPessoal_Alterar",data:n.targetMovimentacao}).then(function(){f();$("#mdlEditar").modal("close");Materialize.toast("Edição concluida com sucesso",4e3);U2X_FechaLoader()},function(n){U2X_TrataErro(n);U2X_FechaLoader();return})};n.getStyle=function(n){return n>0?"green":n==0?"black":"red"};n.getStyleByType=function(n){return n==1?"green":n==2?"Lightblue":"red"};n.trataValores=U2X_TrataValores;n.dataFormat=function(n){return moment(n).format("DD/MM/YYYY")}});