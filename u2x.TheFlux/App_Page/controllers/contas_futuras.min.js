app.controller("contasFuturasCtrl",function(n,t,i,r,u){function h(){n.loggedUsuario=u.getUsuario();n.loggedUsuario||(r.path("/login"),U2X_FechaLoader())}function c(){U2X_AbreLoader();var n=l(),t=a(),i=o();Promise.all([n,t,i]).then(function(){s();U2X_FechaLoader();Materialize.updateTextFields()})}function o(){return new Promise(function(t,r){var u={};u.id_usuario=n.loggedUsuario.id;i({method:"POST",url:"/api/ContaFutura_Obtem",data:u}).then(function(i){n.contas=i.data;t()},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);r()})})}function l(){return new Promise(function(t,r){i({method:"GET",url:u.url+"/api/TipoMovimentacao/"+n.loggedUsuario.id_instituicao}).then(function(i){n.lstTipoMovimentacao=i.data;t()},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);r()})})}function a(){return new Promise(function(t,r){var f={};f.id_instituicao=n.loggedUsuario.id_instituicao;i({method:"POST",url:u.url+"/api/TipoPagamento_Obtem",data:f}).then(function(i){n.lstTipoPagamento=i.data;t()},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);r()})})}function s(){n.conta.parcela=1;n.conta.data=new Date;n.oSearchTipo="-1";n.oSearchStatus="-1";n.oSearchTipoPagamento="-1"}var e={},f;n.lstTipoMovimentacao=[];n.lstTipoPagamentos=[];n.conta={};n.contas=[];n.parcelas=[];n.trataValores=U2X_TrataValores;n.getStyle=function(n){return n>0?"green":"red"};U2X_ConfiguraInterface();h();c();s();n.openCollapsible=function(t,r){if(!r&&e&&e.id==t.id)return!0;n.parcelas=[];U2X_AbreLoader();e=t;var f={};return f.id_conta=t.id,i({method:"POST",url:u.url+"/api/ParcelaFutura_Obtem",data:f}).then(function(t){n.parcelas=t.data;n.parcelas=n.parcelas.sort(function(n,t){return moment(n.dt_include).isBefore(moment(t.dt_include))?-1:moment(n.dt_include).isAfter(moment(t.dt_include))?1:0});U2X_FechaLoader()}),!0};n.CriaConta=function(){if(!n.conta.nome||n.conta.nome==""){Materialize.toast("Digite o [Nome] do novo Tipo de Gasto.",4e3);return}if(!n.conta.id_tipo_pagamento||n.conta.id_tipo_pagamento==""){Materialize.toast("Selecione o [Tipo de Pagamento].",4e3);return}if(!n.conta.id_tipo_movimentacao||n.conta.id_tipo_movimentacao==""){Materialize.toast("Selecione o [Tipo de Movimentação].",4e3);return}if(!n.conta.is_entrada||n.conta.is_entrada==""){Materialize.toast("Selecione entre [Entrada/Saida].",4e3);return}if(!n.conta.valor_base||n.conta.valor_base==""){Materialize.toast("Digite o [Valor].",4e3);return}if(!n.conta.parcela||n.conta.parcela==""){Materialize.toast("Digite a quantidade de  [Parcelas].",4e3);return}if(!n.conta.data||n.conta.data==""){Materialize.toast("Digite a [Data].",4e3);return}n.conta.id_usuario=n.loggedUsuario.id;U2X_AbreLoader();i({method:"POST",url:u.url+"/api/ContaFutura_Criar",data:n.conta}).then(function(t){for(var r,e=[],f=0;f<n.conta.parcela;f++)r={},r.id_movimentacao_futura=t.data,r.dt_include=moment(n.conta.data).add("M",f).toDate(),r.valor_real=n.conta.valor_base,e.push(i({method:"POST",url:u.url+"/api/ParcelaFutura_Criar",data:r}));Promise.all(e).then(function(){$("#mdlContaFutura").modal("close");o();U2X_FechaLoader()})},function(n){console.log(n);Materialize.toast("Não foi possível realizar a operação",4e3);U2X_FechaLoader()})};n.AbreModalCriaConta=function(){n.conta={};$("#mdlContaFutura").modal("open")};n.FechaModalCriaConta=function(){n.conta={};$("#mdlContaFutura").modal("close")};n.getStatus=function(n){return n.is_pago=="1"?"Pago":moment(n.dt_include).isBefore(moment(new Date))?"Atrasado":"Aguardando"};n.getStyle=function(n){return n.is_pago=="1"?"grey":moment(n.dt_include).isBefore(moment(new Date))?"red":"black"};n.dataFormat=function(n){return moment(n).format("DD/MM/YYYY")};n.AbreModalPagamento=function(n,t){f=n;f.nome=t.nome;$("#mdlPagamento").modal("open")};n.FechaModalPagamento=function(){$("#mdlPagamento").modal("close")};n.RealizaPagamento=function(){n.FechaModalPagamento();U2X_AbreLoader();i({method:"POST",url:u.url+"/api/ParcelaFutura_Pagar",data:f}).then(function(){$("#mdlComprovante").modal("open");n.openCollapsible(e,!0);U2X_FechaLoader()})};n.FechaModalComprovante=function(){$("#mdlComprovante").modal("close")};n.EnviaComprovante=function(){f.email=n.emailComprovante;f.dt=moment(f.dt_include).format("DD/MM/YYYY");i({method:"POST",url:u.url+"/api/ParcelaFutura_Comprovante",data:f}).then(function(){$("#mdlComprovante").modal("close");U2X_FechaLoader()})}});